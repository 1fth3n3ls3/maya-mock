# maya_mock

A mock for Autodesk Maya it's `cmds` and `pymel` API. 

Originally developed to ease testing of omtk2. 

## Installation

Using the mock require the `mock` and `enum` python package which you can install with `pip`:

```bash
pip install enum
pip install mock
```

If you plan on running the tests, you will need some additional dependencies:

```bash
pip install pytest
pip install pytest-cov
pip install hypothesis
```

## Testing

You can run the test using `test.sh`.
It will take the installed pytest and will inject in into mayapy environment.
You can use any pytest argument and flag with it:

```bash
./test.sh ./tests/integration_tests/test_cmds.py::test_listAttr --trace
```

- Tests in "/tests/unit_tests" are run against the mock.
- Tests in "/tests/integration_tests" are run against the mock AND maya. Test will fail if results are different
- Tests in "/tests/test_hypothesis" are integration tests generated by hypothesis.


## Usage

You can create a session and interact with it directly.

```python
import maya_mock
session = maya_mock.MockedSession()
session.create_node('transform', name='test')
```

You can also interact with a session via a binding like `cmds` or `pymel`.

```python
import maya_mock
session = maya_mock.MockedSession()
cmds = maya_mock.MockedCmdsSession(session)
cmds.createNode('transform', name='test')
```

```python
import maya_mock
session = maya_mock.MockedSession()
pymel = maya_mock.MockedPymelSession(session)
pymel.createNode('transform', name='test')
```

## Schemas

A schema is a snapshot of a Maya version.

You can generate a search from a maya session with this command:

```python
from maya_mock import MockedSessionSchema
schema = MockedSessionSchema.generate()
```

You can also use generate a schema from anywhere with this simple script:

```bash
./generate ./schemas/test_schema.json
```

By default, a mocked session instance is schema-less.
This mean that a scene will be truly empty and no node type are registered.
Off course, a Maya installation is not as minimal, some objects are pre-registered and an empty scene is not empty.

When initializing a session, you can provide the schema to use:

```python
from maya_mock import MockedSession, MockedSessionSchema
schema = MockedSessionSchema.from_json_file('/path/to.json')
session = MockedSession(schema=schema)
```

## Decorators

You also have access to decorators that will temporary expose a binding.
This is usefull if you have want to use the mock with already existing code.

These decorators will temporary patch `sys.modules` so that any import on  `maya.cmds` or `pymel` will import the mock.

```python
import maya_mock
from maya_mock.decorators import mock_cmds, mock_pymel

session = maya_mock.MockedSession()

with mock_cmds(session) as cmds:
    pass  # Some code


with mock_pymel(session) as pymel:
    pass  # Some code
```

## Contributing

Any contributions are welcome in the form of a PR! 
